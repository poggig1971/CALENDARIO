{"0":"document.addEventListener('DOMContentLoaded', function() {","1":"// Elementi della pagina","2":"const loginView = document.getElementById('login-view');","3":"const appView = document.getElementById('app-view');","4":"const loginBtn = document.getElementById('login-btn');","5":"const logoutBtn = document.getElementById('logout-btn');","6":"const roleSelect = document.getElementById('role-select');","7":"const userRoleDisplay = document.getElementById('user-role-display');","8":"const eventForm = document.getElementById('event-form');","9":"const eventItems = document.getElementById('event-items');","10":"","11":"let currentRole = null;","12":"","13":"// Funzioni per gestire la visualizzazione","14":"function showLogin() {","15":"loginView.style.display = 'block';","16":"appView.style.display = 'none';","17":"}","18":"","19":"function showApp() {","20":"loginView.style.display = 'none';","21":"appView.style.display = 'block';","22":"}","23":"","24":"// Funzioni per il localStorage","25":"function saveEvents(role, events) {","26":"localStorage.setItem('events_' + role, JSON.stringify(events));","27":"}","28":"","29":"function loadEvents(role) {","30":"const eventsData = localStorage.getItem('events_' + role);","31":"return eventsData ? JSON.parse(eventsData) : [];","32":"}","33":"","34":"// Funzione per mostrare gli appuntamenti nella lista","35":"function renderEvents() {","36":"// Svuota la lista","37":"eventItems.innerHTML = '';","38":"// Carica gli eventi relativi al ruolo corrente","39":"const events = loadEvents(currentRole);","40":"// Ordinamento degli eventi per data e ora (opzionale)","41":"events.sort((a, b) => {","42":"const dateA = new Date(a.date + 'T' + a.time);","43":"const dateB = new Date(b.date + 'T' + b.time);","44":"return dateA - dateB;","45":"});","46":"// Crea un elemento per ogni evento","47":"events.forEach(event => {","48":"const li = document.createElement('li');","49":"li.textContent = `${event.date} ${event.time} - ${event.title}` +","50":"(event.location ? ' @ ' + event.location : '') +","51":"` [${event.participation}]`;","52":"","53":"// Pulsante per eliminare l'evento","54":"const deleteBtn = document.createElement('button');","55":"deleteBtn.textContent = 'Elimina';","56":"deleteBtn.addEventListener('click', function() {","57":"deleteEvent(event.id);","58":"});","59":"li.appendChild(deleteBtn);","60":"eventItems.appendChild(li);","61":"});","62":"}","63":"","64":"function deleteEvent(eventId) {","65":"let events = loadEvents(currentRole);","66":"events = events.filter(event => event.id !== eventId);","67":"saveEvents(currentRole, events);","68":"renderEvents();","69":"}","70":"","71":"// Gestione del login","72":"loginBtn.addEventListener('click', function() {","73":"const selectedRole = roleSelect.value;","74":"if (!selectedRole) {","75":"alert('Seleziona un ruolo!');","76":"return;","77":"}","78":"currentRole = selectedRole;","79":"// Mostra il nome del ruolo selezionato","80":"userRoleDisplay.textContent = roleSelect.options[roleSelect.selectedIndex].text;","81":"showApp();","82":"renderEvents();","83":"});","84":"","85":"// Gestione del logout","86":"logoutBtn.addEventListener('click', function() {","87":"currentRole = null;","88":"roleSelect.value = '';","89":"showLogin();","90":"});","91":"","92":"// Gestione del form per aggiungere un evento","93":"eventForm.addEventListener('submit', function(e) {","94":"e.preventDefault();","95":"const date = document.getElementById('event-date').value;","96":"const time = document.getElementById('event-time').value;","97":"const title = document.getElementById('event-title').value;","98":"const location = document.getElementById('event-location').value;","99":"const participation = document.getElementById('event-participation').value;","100":"","101":"if (!date || !time || !title) {","102":"alert('Per favore, compila tutti i campi obbligatori.');","103":"return;","104":"}","105":"","106":"const newEvent = {","107":"id: Date.now(), // ID univoco semplice","108":"date: date,","109":"time: time,","110":"title: title,","111":"location: location,","112":"participation: participation","113":"};","114":"","115":"const events = loadEvents(currentRole);","116":"events.push(newEvent);","117":"saveEvents(currentRole, events);","118":"eventForm.reset();","119":"renderEvents();","120":"});","121":"","122":"// Mostra inizialmente la vista login","123":"showLogin();","124":"});","125":"// Funzione per formattare la data in formato ICS (YYYYMMDDTHHMMSSZ)","126":"function formatDateICS(date) {","127":"const pad = num => String(num).padStart(2, '0');","128":"return date.getUTCFullYear() +","129":"pad(date.getUTCMonth() + 1) +","130":"pad(date.getUTCDate()) + 'T' +","131":"pad(date.getUTCHours()) +","132":"pad(date.getUTCMinutes()) +","133":"pad(date.getUTCSeconds()) + 'Z';","134":"}","135":"","136":"function generateICS(events) {","137":"let icsContent = \"BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//TuoProgetto//Calendario//IT\n\";","138":"","139":"events.forEach(event => {","140":"// Creiamo una data per l'inizio","141":"const startDate = new Date(event.date + 'T' + event.time);","142":"// Impostiamo una durata predefinita, ad esempio 1 ora","143":"const endDate = new Date(startDate);","144":"endDate.setHours(endDate.getHours() + 1);","145":"","146":"icsContent += \"BEGIN:VEVENT\n\";","147":"icsContent += \"UID:\" + event.id + \"\n\";","148":"icsContent += \"DTSTAMP:\" + formatDateICS(new Date()) + \"\n\";","149":"icsContent += \"DTSTART:\" + formatDateICS(startDate) + \"\n\";","150":"icsContent += \"DTEND:\" + formatDateICS(endDate) + \"\n\";","151":"icsContent += \"SUMMARY:\" + event.title + \"\n\";","152":"if (event.location) {","153":"icsContent += \"LOCATION:\" + event.location + \"\n\";","154":"}","155":"icsContent += \"END:VEVENT\n\";","156":"});","157":"","158":"icsContent += \"END:VCALENDAR\";","159":"return icsContent;","160":"}","161":"","162":"// Funzione per scaricare il file ICS","163":"function downloadICS() {","164":"// Carica gli eventi per il ruolo corrente (la funzione loadEvents è quella già presente)","165":"const events = loadEvents(currentRole);","166":"const icsData = generateICS(events);","167":"const blob = new Blob([icsData], { type: 'text/calendar;charset=utf-8' });","168":"const url = URL.createObjectURL(blob);","169":"","170":"// Crea un link per il download","171":"const link = document.createElement('a');","172":"link.href = url;","173":"link.download = 'calendario_' + currentRole + '.ics';","174":"document.body.appendChild(link);","175":"link.click();","176":"document.body.removeChild(link);","177":"}","178":"const exportIcsBtn = document.getElementById('export-ics-btn');","179":"","180":"exportIcsBtn.addEventListener('click', function() {","181":"downloadICS();","182":"});","183":""}